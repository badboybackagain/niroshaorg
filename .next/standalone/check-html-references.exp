#!/usr/bin/expect -f

set timeout 60
set host "37.27.54.247"
set user "nirosha_1"
set password "Celorita13jan!!"
set port "22"

spawn ssh -p $port $user@$host

expect {
    "password:" {
        send "$password\r"
        exp_continue
    }
    "yes/no" {
        send "yes\r"
        exp_continue
    }
    "$ " {
        send "cd /var/www/5fcedb5f-4188-4356-a8e9-4f09d37e27af/public_html\r"
        expect "$ "
        send "echo '=== Checking index.html for all script tags ==='\r"
        expect "$ "
        send "grep -i 'script.*src' index.html | grep -i 'contact\|assets'\r"
        expect "$ "
        send "echo '=== Checking which ContactPage file is referenced ==='\r"
        expect "$ "
        send "grep -o 'ContactPage-[^\"']*' index.html 2>/dev/null || echo 'Not found in index.html (might be lazy loaded)'\r"
        expect "$ "
        send "echo '=== Checking if file exists and is readable ==='\r"
        expect "$ "
        send "LATEST=\$(ls -t assets/js/ContactPage*.js 2>/dev/null | head -1) && echo \"Checking: \$LATEST\" && test -r \"\$LATEST\" && echo 'File is readable' || echo 'File not readable'\r"
        expect "$ "
        send "echo '=== Extracting console.log statements from ContactPage ==='\r"
        expect "$ "
        send "LATEST=\$(ls -t assets/js/ContactPage*.js 2>/dev/null | head -1) && grep -o 'console\\.log([^)]*)' \"\$LATEST\" 2>/dev/null | head -5\r"
        expect "$ "
        send "echo '=== Checking for syntax errors (basic check) ==='\r"
        expect "$ "
        send "LATEST=\$(ls -t assets/js/ContactPage*.js 2>/dev/null | head -1) && node -c \"\$LATEST\" 2>&1 && echo 'Syntax OK' || echo 'Syntax error found'\r"
        expect "$ "
        send "exit\r"
    }
    "# " {
        send "cd /var/www/5fcedb5f-4188-4356-a8e9-4f09d37e27af/public_html\r"
        expect "# "
        send "exit\r"
    }
}

expect eof
