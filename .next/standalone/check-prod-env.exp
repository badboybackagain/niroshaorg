#!/usr/bin/expect -f

set timeout 60
set host "37.27.54.247"
set user "nirosha_1"
set password "Celorita13jan!!"
set port "22"

spawn ssh -p $port $user@$host

expect {
    "password:" {
        send "$password\r"
        exp_continue
    }
    "yes/no" {
        send "yes\r"
        exp_continue
    }
    "$ " {
        send "cd /var/www/5fcedb5f-4188-4356-a8e9-4f09d37e27af\r"
        expect "$ "
        send "echo '=== Checking for .env files ==='\r"
        expect "$ "
        send "find . -name '.env*' -type f 2>/dev/null | head -10\r"
        expect "$ "
        send "echo ''\r"
        expect "$ "
        send "echo '=== Checking public_html for .env ==='\r"
        expect "$ "
        send "ls -la public_html/.env* 2>/dev/null || echo 'No .env files in public_html'\r"
        expect "$ "
        send "echo ''\r"
        send "cd public_html\r"
        expect "$ "
        send "echo '=== Checking latest ContactPage file for localhost ==='\r"
        expect "$ "
        send "LATEST=\$(ls -t assets/js/ContactPage*.js 2>/dev/null | head -1); echo \"File: \$LATEST\"; grep -o 'localhost:3000' \"\$LATEST\" 2>/dev/null | head -3 && echo 'FOUND localhost:3000' || echo 'NOT FOUND'\r"
        expect "$ "
        send "echo ''\r"
        send "echo '=== Checking for VITE_CONTACT_API_URL in ContactPage ==='\r"
        expect "$ "
        send "LATEST=\$(ls -t assets/js/ContactPage*.js 2>/dev/null | head -1); grep -o 'VITE_CONTACT_API_URL' \"\$LATEST\" 2>/dev/null | head -1 && echo 'FOUND' || echo 'NOT FOUND'\r"
        expect "$ "
        send "echo ''\r"
        send "echo '=== Extracting endpoint logic from ContactPage ==='\r"
        expect "$ "
        send "LATEST=\$(ls -t assets/js/ContactPage*.js 2>/dev/null | head -1); grep -o 'localhost:3000/api/contact' \"\$LATEST\" 2>/dev/null | head -1 && echo 'Found localhost endpoint' || echo 'No localhost endpoint found'\r"
        expect "$ "
        send "echo ''\r"
        send "echo '=== Checking for /api/contact in ContactPage ==='\r"
        expect "$ "
        send "LATEST=\$(ls -t assets/js/ContactPage*.js 2>/dev/null | head -1); grep -o '/api/contact' \"\$LATEST\" 2>/dev/null | head -1 && echo 'Found /api/contact' || echo 'Not found'\r"
        expect "$ "
        send "exit\r"
    }
}

expect eof

